{% extends 'base.html' %}
{% block title %}Edit Student - ASWATHAMA CLASSES{% endblock %}
{% block content %}
<section class="admin-section">
    <div class="container" style="max-width:1000px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:40px;">
            <h1>Editing: {{ student.name }} ({{ student.id }})</h1>
            <a href="{{ url_for('teacher_dashboard') }}" class="btn btn-outline">Back to List</a>
        </div>
        
        <form action="{{ url_for('teacher_edit_student', student_id=student.id) }}" method="POST" style="display:flex; flex-direction:column; gap:40px;">
            <!-- Basic Info -->
            <div class="admin-card" style="background:#f9f9f9; padding:25px; border:1px solid #ddd;">
                <h3>Basic Information</h3>
                <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:20px; margin-top:15px;">
                    <input type="text" name="name" value="{{ student.name }}" placeholder="Name" required style="padding:12px; border:1px solid #ddd;">
                    <input type="text" name="class" value="{{ student.class }}" placeholder="Class" required style="padding:12px; border:1px solid #ddd;">
                    <input type="email" name="email" value="{{ student.email }}" placeholder="Email" style="padding:12px; border:1px solid #ddd;">
                    <input type="text" name="phone" value="{{ student.phone }}" placeholder="Phone" style="padding:12px; border:1px solid #ddd;">
                </div>
            </div>

            <!-- Weekly Tests -->
            <div class="admin-card" style="background:#f9f9f9; padding:25px; border:1px solid #ddd;">
                <h3>Weekly Tests</h3>
                <div id="test-list" style="margin-top:15px; display:flex; flex-direction:column; gap:10px;">
                    {% for test in student.get('tests', []) %}
                    <div class="test-row" style="display:grid; grid-template-columns: 2fr 1.5fr 1fr 1fr auto; gap:10px;">
                        <input type="text" name="test_name[]" value="{{ test.name }}" placeholder="Test Name" style="padding:10px; border:1px solid #ddd;">
                        <input type="date" name="test_date[]" value="{{ test.date }}" style="padding:10px; border:1px solid #ddd;">
                        <input type="number" name="test_marks[]" value="{{ test.marks }}" placeholder="Marks" style="padding:10px; border:1px solid #ddd;">
                        <input type="number" name="test_total[]" value="{{ test.total }}" placeholder="Total" style="padding:10px; border:1px solid #ddd;">
                        <button type="button" onclick="this.parentElement.remove()" style="color:red; background:none; border:none; cursor:pointer;">✕</button>
                    </div>
                    {% endfor %}
                </div>
                <button type="button" onclick="addTestRow()" class="btn btn-outline" style="margin-top:15px; font-size:12px; padding:8px 15px;">+ Add Weekly Test</button>
            </div>

            <!-- Attendance -->
            <div class="admin-card" style="background:#f9f9f9; padding:25px; border:1px solid #ddd;">
                <h3>Daily Attendance Log</h3>
                <div id="attendance-list" style="margin-top:15px; display:flex; flex-direction:column; gap:10px;">
                    {% for log in student.get('attendance_log', []) %}
                    <div class="attendance-row" style="display:grid; grid-template-columns: 1fr 1fr auto; gap:10px;">
                        <input type="date" name="att_date[]" value="{{ log.date }}" style="padding:10px; border:1px solid #ddd;">
                        <select name="att_status[]" style="padding:10px; border:1px solid #ddd;">
                            <option value="Present" {% if log.status == 'Present' %}selected{% endif %}>Present</option>
                            <option value="Absent" {% if log.status == 'Absent' %}selected{% endif %}>Absent</option>
                        </select>
                        <button type="button" onclick="this.parentElement.remove()" style="color:red; background:none; border:none; cursor:pointer;">✕</button>
                    </div>
                    {% endfor %}
                </div>
                <button type="button" onclick="addAttendanceRow()" class="btn btn-outline" style="margin-top:15px; font-size:12px; padding:8px 15px;">+ Add Attendance Entry</button>
            </div>

            <button type="submit" class="btn btn-primary" style="padding:20px;">Save All Student Data</button>
        </form>
    </div>
</section>

<script>
function addTestRow() {
    const container = document.getElementById('test-list');
    const div = document.createElement('div');
    div.className = 'test-row';
    div.style = 'display:grid; grid-template-columns: 2fr 1.5fr 1fr 1fr auto; gap:10px;';
    div.innerHTML = `
        <input type="text" name="test_name[]" placeholder="Test Name" style="padding:10px; border:1px solid #ddd;">
        <input type="date" name="test_date[]" value="${new Date().toISOString().split('T')[0]}" style="padding:10px; border:1px solid #ddd;">
        <input type="number" name="test_marks[]" placeholder="Marks" style="padding:10px; border:1px solid #ddd;">
        <input type="number" name="test_total[]" placeholder="Total" value="100" style="padding:10px; border:1px solid #ddd;">
        <button type="button" onclick="this.parentElement.remove()" style="color:red; background:none; border:none; cursor:pointer;">✕</button>
    `;
    container.appendChild(div);
}

function addAttendanceRow() {
    const container = document.getElementById('attendance-list');
    const div = document.createElement('div');
    div.className = 'attendance-row';
    div.style = 'display:grid; grid-template-columns: 1fr 1fr auto; gap:10px;';
    div.innerHTML = `
        <input type="date" name="att_date[]" value="${new Date().toISOString().split('T')[0]}" style="padding:10px; border:1px solid #ddd;">
        <select name="att_status[]" style="padding:10px; border:1px solid #ddd;">
            <option value="Present">Present</option>
            <option value="Absent">Absent</option>
        </select>
        <button type="button" onclick="this.parentElement.remove()" style="color:red; background:none; border:none; cursor:pointer;">✕</button>
    `;
    container.appendChild(div);
}
</script>
{% endblock %}
